# 基本情報技術者試験：コンピュータシステムの完全理解

> **作成日**: 2025年10月28日
> **目的**: コンピュータシステムの本質を理解し、計算問題を確実に解けるようにする

---

## 目次

1. [CPUの構造と性能](#1-cpuの構造と性能)
2. [メモリシステム](#2-メモリシステム)
3. [記憶装置とRAID](#3-記憶装置とraid)
4. [システム性能と稼働率](#4-システム性能と稼働率)
5. [入出力制御](#5-入出力制御)

---

## 1. CPUの構造と性能

### 1-1. CPUの基本構成

**CPUの三大要素**:

```
【CPU内部の構成】

┌─────────────────────────┐
│  CPU（中央処理装置）      │
├─────────────────────────┤
│  制御装置（CU）           │
│  ├─ 命令レジスタ         │
│  ├─ プログラムカウンタ   │
│  └─ 命令デコーダ         │
├─────────────────────────┤
│  演算装置（ALU）          │
│  ├─ 算術演算             │
│  ├─ 論理演算             │
│  └─ アキュムレータ       │
├─────────────────────────┤
│  レジスタ群               │
│  ├─ 汎用レジスタ         │
│  ├─ インデックスレジスタ │
│  └─ スタックポインタ     │
└─────────────────────────┘
```

**各要素の役割**:

| 要素 | 役割 | 例え |
|------|------|------|
| 制御装置 | 命令の解読と実行制御 | オーケストラの指揮者 |
| 演算装置 | 計算と論理演算 | 計算機 |
| レジスタ | 超高速な一時記憶 | 作業机の上 |

---

### 1-2. 命令実行サイクル（フェッチ・デコード・実行）

```
【命令実行の5段階】

1. フェッチ（Fetch）
   メモリから命令を取り出す
   例: ADD命令を取得

2. デコード（Decode）
   命令を解読する
   例: "レジスタAとBを加算"と理解

3. オペランド読み取り
   必要なデータを取得
   例: レジスタAとBの値を読む

4. 実行（Execute）
   実際に演算を行う
   例: 3 + 5 = 8を計算

5. ライトバック
   結果を保存
   例: 結果の8をレジスタに書き込む
```

---

### 1-3. パイプライン処理

**なぜパイプライン処理が必要か？**

```
【逐次処理（パイプラインなし）】

命令1: [F][D][E][W]
命令2:         [F][D][E][W]
命令3:                 [F][D][E][W]

4サイクル × 3命令 = 12サイクル

---

【パイプライン処理】

命令1: [F][D][E][W]
命令2:    [F][D][E][W]
命令3:       [F][D][E][W]

4 + 2 + 2 = 8サイクル

★同じ3命令が1.5倍速く完了
```

**パイプラインハザード（障害）**:

```
【データハザード】

命令1: R1 ← R2 + R3
命令2: R4 ← R1 + R5  ← R1がまだ確定していない！

対策: ストール（待機）を挿入

---

【制御ハザード】

命令1: IF R1 > 0 THEN JUMP
命令2: R2 ← R3 + R4  ← ジャンプするか不明

対策: 分岐予測、遅延分岐スロット
```

---

### 1-4. CPU性能計算

#### MIPS（Million Instructions Per Second）

**公式**:
```
MIPS = クロック周波数（MHz） / CPI
CPI = Cycles Per Instruction（1命令あたりのクロックサイクル数）
```

**例題1**:
```
【問題】
クロック周波数: 2GHz（2000MHz）
CPI: 4
このCPUのMIPS値は？

【解答】
MIPS = 2000MHz / 4 = 500MIPS

★1秒間に5億命令を実行できる
```

**例題2**:
```
【問題】
100MIPS、CPI=2のCPUのクロック周波数は？

【解答】
クロック周波数 = MIPS × CPI
              = 100 × 2
              = 200MHz
```

---

#### 命令実行時間の計算

**公式**:
```
実行時間 = 命令数 × CPI / クロック周波数
```

**例題3**:
```
【問題】
・命令数: 1,000,000命令
・CPI: 5
・クロック周波数: 1GHz（1000MHz）

プログラムの実行時間は？

【解答】
実行時間 = 1,000,000 × 5 / (1000 × 10^6)
        = 5,000,000 / 1,000,000,000
        = 0.005秒
        = 5ミリ秒
```

---

### 1-5. クロック周波数とコア数

**なぜ高クロックだけでは速くならないか？**

```
【発熱と消費電力の問題】

クロック周波数 → 消費電力 → 発熱
2倍           → 4倍       → 冷却困難

★3GHz以上は技術的に困難
→ マルチコア化へ
```

**マルチコアの効果**:

```
【シングルコア vs マルチコア】

シングルコア（4GHz）:
タスク1 → タスク2 → タスク3 → タスク4
[4秒]

デュアルコア（2GHz × 2）:
コア1: タスク1 → タスク3
コア2: タスク2 → タスク4
[2秒]

★並列処理可能な場合は2倍速
```

**注意点**:
```
並列化効率 ≠ 100%

理由:
1. タスク間の依存関係
2. データの競合
3. 同期のオーバーヘッド

実際の性能向上 ≒ コア数 × 0.7〜0.9
```

---

## 2. メモリシステム

### 2-1. メモリ階層

```
【メモリピラミッド】

レジスタ      [最速・最小・最高価格]
  ↓ 1ns
L1キャッシュ   32-64KB
  ↓ 2-4ns
L2キャッシュ   256KB-1MB
  ↓ 10ns
L3キャッシュ   8-32MB
  ↓ 20ns
主記憶（RAM）  8-64GB
  ↓ 100ns
SSD           512GB-2TB
  ↓ 100μs (100,000ns)
HDD           2-10TB     [最遅・最大・最安価格]
  ↓ 10ms (10,000,000ns)
```

**速度差の実感**:
```
レジスタを「1秒」とすると...

L1キャッシュ: 2-4秒
主記憶: 100秒（1分40秒）
SSD: 1日
HDD: 4ヶ月

★階層的にキャッシュが必要な理由
```

---

### 2-2. キャッシュメモリ

#### キャッシュヒットとミス

```
【キャッシュヒット】
CPU → キャッシュ → データあり → 高速アクセス

【キャッシュミス】
CPU → キャッシュ → データなし → 主記憶へ → 低速
```

#### 実効アクセス時間の計算

**公式**:
```
実効アクセス時間 = ヒット率 × キャッシュアクセス時間
                 + (1 - ヒット率) × 主記憶アクセス時間
```

**例題4**:
```
【問題】
・キャッシュヒット率: 90%
・キャッシュアクセス時間: 10ns
・主記憶アクセス時間: 100ns

実効アクセス時間は？

【解答】
実効アクセス時間 = 0.9 × 10 + 0.1 × 100
                = 9 + 10
                = 19ns

★キャッシュヒット率が高いと約5倍速い
（100ns → 19ns）
```

**例題5（頻出）**:
```
【問題】
現在の実効アクセス時間: 30ns
キャッシュを追加して実効アクセス時間を15nsにしたい
新キャッシュのアクセス時間: 5ns
必要なヒット率は？

【解答】
15 = x × 5 + (1-x) × 30
15 = 5x + 30 - 30x
15 = 30 - 25x
25x = 15
x = 0.6 = 60%

★60%以上のヒット率が必要
```

---

### 2-3. 仮想記憶（Virtual Memory）

**なぜ仮想記憶が必要か？**

```
【問題】
物理メモリ: 8GB
実行したいプログラム: 合計20GB

→ 物理メモリに入りきらない
```

**解決策: 仮想記憶**

```
【仮想記憶の仕組み】

仮想アドレス空間（論理アドレス）
0x00000000 ～ 0xFFFFFFFF（4GB）
        ↓
     ページテーブル（変換表）
        ↓
物理アドレス空間（実メモリ）
0x00000000 ～ 0x1FFFFFFF（512MB）
        ↓
   使われていないページ
        ↓
    ディスク（スワップ領域）
```

#### ページングとスワッピング

**ページング**:
```
メモリを「ページ」という固定サイズに分割
典型的なサイズ: 4KB

例:
ページ0: 0x0000-0x0FFF（4KB）
ページ1: 0x1000-0x1FFF（4KB）
ページ2: 0x2000-0x2FFF（4KB）
```

**スワッピング**:
```
【スワップアウト】
使われていないページをディスクへ退避

【スワップイン】
必要になったページをメモリへ読み込み

★問題: スラッシング
頻繁なスワップで性能が激減する現象
```

**例題6**:
```
【問題】
ページサイズ: 4KB（4096バイト）
仮想アドレス: 0x5234

ページ番号とページオフセットは？

【解答】
0x5234 = 21044（10進数）

ページ番号 = 21044 / 4096 = 5
オフセット  = 21044 % 4096 = 180

ページ5の180バイト目
```

---

### 2-4. メモリインタリーブ

**複数のメモリバンクを並列アクセス**

```
【通常のメモリアクセス】
アドレス0 → バンク0
アドレス1 → バンク0
アドレス2 → バンク0
アドレス3 → バンク0

連続アクセス: 4 × 100ns = 400ns

---

【4ウェイインタリーブ】
アドレス0 → バンク0 ┐
アドレス1 → バンク1 ├─ 並列アクセス
アドレス2 → バンク2 │
アドレス3 → バンク3 ┘

連続アクセス: 100ns + 待機なし = 100ns

★4倍高速
```

---

## 3. 記憶装置とRAID

### 3-1. 記憶装置の比較

| 種類 | 容量 | 速度 | 価格/GB | 特徴 |
|------|------|------|---------|------|
| **HDD** | 大（2-20TB） | 遅（100MB/s） | 安（3-5円） | 機械式、消費電力大 |
| **SSD** | 中（500GB-4TB） | 速（500MB/s） | 中（10-20円） | 半導体、書き込み回数制限 |
| **NVMe SSD** | 中（500GB-2TB） | 超速（3000MB/s） | 高（20-30円） | PCIe接続、最新 |

---

### 3-2. RAID（Redundant Array of Independent Disks）

**RAIDの目的**:
- 信頼性向上（冗長化）
- 性能向上（並列化）

#### RAID 0（ストライピング）

```
【構成】
データを複数ディスクに分散

ファイル「ABCDEFGH」
ディスク0: A C E G
ディスク1: B D F H

メリット: 読み書き速度2倍
デメリット: 1台でも壊れると全データ喪失

用途: 動画編集など高速性重視
```

#### RAID 1（ミラーリング）

```
【構成】
全データを2台に複製

ディスク0: ABCDEFGH
ディスク1: ABCDEFGH（同じ）

メリット: 1台壊れてもデータ保持
デメリット: 容量半分、コスト2倍

用途: サーバーのシステムドライブ
```

#### RAID 5（分散パリティ）

```
【構成】
3台以上、パリティを分散配置

ディスク0: A B P(C,D)
ディスク1: C P(A,B) E
ディスク2: P(E,F) D F

Pはパリティ（エラー訂正符号）

メリット:
- 1台故障しても復旧可能
- 容量効率良い（n-1台分使える）

デメリット:
- 書き込み性能やや低下
- 2台同時故障でデータ喪失

用途: 企業の一般的なサーバー
```

**RAID 5の容量計算**:

**例題7**:
```
【問題】
1TB HDD × 4台でRAID 5構成
使用可能な容量は？

【解答】
使用可能容量 = (ディスク台数 - 1) × 1台の容量
             = (4 - 1) × 1TB
             = 3TB

★1台分がパリティに使われる
```

#### RAID 6（二重パリティ）

```
【構成】
RAID 5 + パリティがもう1つ

メリット: 2台同時故障でも復旧可能
デメリット: 容量効率低下（n-2台分）

用途: 超重要データ（金融、医療）
```

---

## 4. システム性能と稼働率

### 4-1. 稼働率の基本

**稼働率 = 正常動作時間 / 全体時間**

**例題8**:
```
【問題】
1ヶ月（30日 = 720時間）のうち
ダウンタイム: 7.2時間

稼働率は？

【解答】
稼働率 = (720 - 7.2) / 720
       = 712.8 / 720
       = 0.99
       = 99%
```

---

### 4-2. 直列システムの稼働率

**システム = 全てが動いて初めて動作**

```
【直列接続】
[A] → [B] → [C]

稼働率 = A × B × C
```

**例題9**:
```
【問題】
サーバーA: 稼働率90%
サーバーB: 稼働率95%

この2台が直列接続された場合の稼働率は？

【解答】
稼働率 = 0.9 × 0.95
       = 0.855
       = 85.5%

★直列にすると稼働率が下がる
```

---

### 4-3. 並列システムの稼働率

**どちらか一方が動けばシステム動作**

```
【並列接続（冗長化）】
      [A]
    /   \
[入力]   [出力]
    \   /
      [B]

稼働率 = 1 - (1-A) × (1-B)
      = 1 - (両方壊れる確率)
```

**例題10（超頻出）**:
```
【問題】
サーバーA: 稼働率90%
サーバーB: 稼働率90%

2台を並列接続（冗長化）した場合の稼働率は？

【解答】
稼働率 = 1 - (1-0.9) × (1-0.9)
       = 1 - 0.1 × 0.1
       = 1 - 0.01
       = 0.99
       = 99%

★並列にすると稼働率が上がる
```

---

### 4-4. 複合システムの稼働率

**例題11（難問）**:
```
【問題】
以下のシステム構成の稼働率は？

       [B:0.9]
      /       \
[A:0.8] ─────── [D:0.9]
      \       /
       [C:0.9]

A → (BとCの並列) → D の直列構成

【解答】
ステップ1: BとCの並列部分
= 1 - (1-0.9) × (1-0.9)
= 1 - 0.01
= 0.99

ステップ2: A → (B//C) → D の直列
= 0.8 × 0.99 × 0.9
= 0.7128
= 71.28%
```

---

### 4-5. MTBF・MTTR

**MTBF（Mean Time Between Failures）: 平均故障間隔**
```
MTBF = 正常動作時間の合計 / 故障回数
```

**MTTR（Mean Time To Repair）: 平均修理時間**
```
MTTR = 修理時間の合計 / 故障回数
```

**稼働率との関係**:
```
稼働率 = MTBF / (MTBF + MTTR)
```

**例題12**:
```
【問題】
MTBF: 2000時間
MTTR: 8時間

稼働率は？

【解答】
稼働率 = 2000 / (2000 + 8)
       = 2000 / 2008
       = 0.996
       = 99.6%
```

---

## 5. 入出力制御

### 5-1. 入出力方式の種類

#### プログラム制御方式

```
【動作】
CPUが直接入出力を制御

while True:
    if デバイスready:
        データ転送
        break
    # ビジーウェイト

デメリット: CPUがデバイス待ちで専有される
```

#### 割り込み方式

```
【動作】
1. CPUがデバイスに命令を出す
2. CPUは他の処理を実行
3. デバイスready → CPUに割り込み
4. CPUがデータ転送処理

メリット: CPU効率向上
```

#### DMA（Direct Memory Access）

```
【動作】
1. CPUがDMAコントローラに転送指示
2. DMAコントローラが主記憶⇔デバイスを直接転送
3. 転送完了後にCPUに割り込み

メリット: CPU負荷ほぼゼロ

用途: 大容量データ転送（ディスク、ネットワーク）
```

---

### 5-2. 転送時間の計算

**公式**:
```
転送時間 = データサイズ / 転送速度
```

**例題13**:
```
【問題】
100MBのファイルを転送
転送速度: 1Gbps（= 125MB/s）

転送時間は？

【解答】
転送時間 = 100MB / 125MB/s
        = 0.8秒
```

**単位変換の注意**:
```
1Gbps = 1,000Mbps
      = 125MB/s（8で割る）

1Byte = 8bit
```

---

## まとめ：試験対策のポイント

### 最重要計算問題

1. **MIPS計算** - ほぼ毎回出題
2. **キャッシュ実効アクセス時間** - 頻出
3. **稼働率計算（直列・並列）** - 必出
4. **RAID容量計算** - 頻出

### 暗記すべき数値

```
キャッシュ階層:
L1: 数十KB、1-2ns
L2: 数百KB、10ns
L3: 数MB、20ns
主記憶: 数GB、100ns

ディスク:
HDD: 10ms（10,000,000ns）
SSD: 100μs（100,000ns）
```

### 公式一覧

```
1. MIPS = クロック周波数 / CPI

2. 実効アクセス時間 = ヒット率 × キャッシュ時間
                   + (1-ヒット率) × 主記憶時間

3. 直列稼働率 = A × B × C

4. 並列稼働率 = 1 - (1-A) × (1-B)

5. 稼働率 = MTBF / (MTBF + MTTR)
```

---

**このノートでコンピュータシステムの理解と計算力を確実に身につけよう！**

**頑張ってください！** 🎉
